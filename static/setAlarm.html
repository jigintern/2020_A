<!DOCTYPE html>
<html lang="jp">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="./setAlarm.css">
	<title>時刻設定</title>

</head>

<body>
	<header>
	
	</header>
	<br>

	<font1>
		<h1>起床時間の設定</h1>
	</font1>
	<hr color="red">

	<br><br><br>

	<center>
		<font1>
			<h1 id="time"></h1>
		</font1>
	</center>

	<br><br>

	<script>
		time();
		function time() {
			var now = new Date();
			document.getElementById("time").innerHTML = now.toLocaleString();
		}
		setInterval('time()', 1000);
	</script>

	<form id="input-form">

		<br><br>
		<center>
			<div class="size">
				<input type="datetime-local" id="datetime" size=50 style="font-size:30px;">
			</div>
			<br>
			<div class="cp_ipselect cp_sl04">
				<span style="color:white">難易度：</span>
				<select name="difficulty" id="difficulty">
					<option value="">なし</option>
					<option value="S">S</option>
					<option value="A">A</option>
					<option value="B">B</option>
					<option value="C">C</option>
					<option value="D">D</option>
					<option value="E">E</option>
				</select>
			</div>
			<br><br>
			<input type="submit" value"送信" class="button">
		</center>
	
		<h3 id="set-result"></h3>
		
	<br>
	
	</form>
	<br><br><br>
	
	
	<br><br>

	<script type="module">
		import { fetchJSON } from "https://code4sabae.github.io/js/fetchJSON.js";
		import { askNotification, getUuid } from "./util.js";

		var uuid = undefined;

		window.onload = async () => {
			askNotification();

			uuid = await getUuid();
			console.log(uuid);
		}

		const inputForm = document.getElementById("input-form");
		inputForm.addEventListener('submit', async (event) => {
			event.preventDefault();

			const utc = new Date(datetime.value).getTime();

			const status = document.getElementById("status");
			if (isNaN(utc)) {
				window.alert("入力したデータが無効です");
			} else {
				const res = await fetchJSON("/api/setalarm", {
					id: uuid, time: utc, difficultyChoice: difficulty.value
				});
				//ta.value = JSON.stringify(res);
				const setResult = document.getElementById("set-result");

				if (res.res === "OK") {
					setResult.textContent = "アラーム設定完了！";
				}
			}
		});

	</script>
</body>

</html>