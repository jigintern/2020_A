<!DOCTYPE html>
<html lang="jp">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel= "stylesheet" href="./set.css">
	<title>時刻設定</title>
	
</head>

<body>

	<font1><h1>起床時間の設定</h1> </font1>
	<hr color="red">

<br><br><br>

	 <center>
		<font1><h1 id="time"></h1> </font1>
	</center>

<br><br>
	
    <script>
    time();
    function time(){
        var now = new Date();
        document.getElementById("time").innerHTML = now.toLocaleString();
    }
    setInterval('time()',1000);
    </script>



	<script>
		async function set(e) {
			const data = document.getElementById("time");
			const utc = new Date(data.value);

			utc.getTime();
			console.log(new Date(utc.getTime()));

			const resJson = {
				utc: utc.getTime()
			};

			await fetch("/api/set", {
				method: "POST",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify(resJson),
			});
		}
	</script>
	<form id="input-form">

<br><br>
	<center>	
	<input type="datetime-local" id="datetime">

<br><br><br>
		
			<input type="submit" value"送信" class="button">
	</center>
	
	</form>
<br><br><br>
	<font1>res:</font1>
<br>
	<textarea id="ta" style="width:60vw; height:8em;"></textarea>

	<script type="module">
		import { fetchJSON } from "https://code4sabae.github.io/js/fetchJSON.js";

		window.onload = () => {
			// 通知を許可するかユーザに問いかける
			navigator.serviceWorker.register("sw.js").then(() => {
				Notification.requestPermission(function (permission) {
					if (permission === 'denied') {
						alert('プッシュ通知を有効にできません。ブラウザの設定を確認して下さい。');
					}
				});
			});
		}

		const inputForm = document.getElementById("input-form");
		inputForm.addEventListener('submit', async (event) => {
			event.preventDefault();

			const utc = new Date(datetime.value).getTime();

			const status = document.getElementById("status");
			if (isNaN(utc)) {
				ta.value = "入力したデータが無効です";
			} else {
				const res = await fetchJSON("/api/setalarm", { id: 0, time: utc });
				ta.value = JSON.stringify(res);
			}
		});
	</script>
</body>

</html>

